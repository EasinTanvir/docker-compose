name: Local Auto Deploy

on:
    push:
        branches:
            - main

jobs:
    rebuild-and-restart:
        runs-on: self-hosted
        steps:
            - name: Checkout latest code
              uses: actions/checkout@v4

            - name: Rebuild and restart containers (no downtime)
              run: |
                  echo "ğŸ”„ Pulling latest code..."
                  git fetch origin main
                  git reset --hard origin/main

                  echo "âš™ï¸ Rebuilding containers safely..."
                  docker compose -p prodapp build

                  echo "ğŸš€ Starting updated containers..."
                  docker compose -p prodapp up -d --remove-orphans

                  echo "âœ… Deployment complete."
